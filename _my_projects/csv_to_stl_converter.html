<!DOCTYPE html>
<html>
<head>
    <title>Upload to S3</title>
    <link rel="stylesheet" href="/teaching/assets/main.css">
</head>
<body>
    <h1>3D Printing CSV Data</h1>

    <p>
    I worked with the science department (physics) to allow them to 3D print data
    that the students gathered during various experiments. It initially came about
    as a way to show students what measurements of magnetism on a electrified plate
    looks like, but it really can be anything. For example, the picture below shows
    the result of the conversion which can then be used to 3D print the data.
    </p>

    <!-- Image inclusion -->
    <img src="/teaching/assets/stl_conversion.png" alt="Picture of converted csv data" width="400">

    <!-- File upload interface -->
    <div id="upload_form">
        <p>Click here to upload a `.csv` file and get the converted `.stl`</p>
        <div>
            <input id="fileUpload" type="file" />
            <button id="uploadButton" onclick="uploadFile()">Upload File</button>
        </div>
    </div>
    <p></p>
    <div id="downloadMessage">After upload, transform will be available for download here</div>

    <script>
    async function uploadFile() {
        const fileInput = document.getElementById('fileUpload');
        const file = fileInput.files[0];
        const downloadMessage = document.getElementById('downloadMessage');

        if (!file) {
            alert('No file selected.');
            return;
        }

        downloadMessage.innerHTML = "Transforming....";

        const reader = new FileReader();
        reader.onloadend = function() {
            // Get the file contents
            const arrayBuffer = reader.result;

            fetch('https://mvni37cg8e.execute-api.us-east-2.amazonaws.com/csv', {
                method: 'POST',
                headers: {
                    'Content-Type': file.type,
                },
                body: arrayBuffer,
            })
            .then(response => {
                // Ensure the request was successful
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json(); // Parse the JSON in the response
            })
            .then(data => {
                console.log('Success:', data);
                
                // Read the "location" field from the response
                const location = data.location;
                console.log('Location:', location);
                downloadMessage.innerHTML = `<a href="${location}">Download File</a>`;
            })
            .catch(error => {
                console.error('Error during fetch:', error);
                alert('Error uploading file.');
            });
        };

        reader.readAsArrayBuffer(file); // Read the file as a Data URL (base64)
    }

    </script>

</body>
</html>
