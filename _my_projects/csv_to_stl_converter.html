<!DOCTYPE html>
<html>
<head>
    <title>Upload to S3</title>
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.css">
</head>
<body>
    <h1>3D Printing CSV Data</h1>

    <p>
        This website was created to convert <strong>.CSV files</strong> into
        <strong>.STL files</strong> so they can be 3D printed.
    </p>
    <p>
        The original intention of this website was to take Electric Potential
        Data collected on Conductive Paper and allow students to 3D print their
        collected Electric Potential Map. The website maps the rows and columns
        to the X and Y axis and maps the value in each cell to the Z axis for
        the 3D printer.
    </p>
    <p>
        Beyond Conductive data, though, any <strong>.CSV file</strong> that is
        basically a "height map" with X and Y coordinates and a Z "height" can
        be converted. This allows for a wide variety of experiments to be
        represented and printed.
    </p>

    <!-- Image inclusion -->
    <img src="/teaching/assets/stl_conversion.png" alt="Picture of converted csv data" width="620">

    <h2>The steps for how to convert your data are:</h2>
    <ol>
        <li>
            Copy any Electric Potential Data into a blank spreadsheet where
            <em>ONLY</em> the data is included. The data should start in the
            <em>top left corner</em> of the spreadsheet. Make sure the
            spreadsheet is saved as a <strong>.CSV file</strong> and not as
            a .xls, or .xlsx, or a Google Sheets file.
        </li>
        <li>
            Navigate to the Transformation Form (below)
        </li>
        <li>
            Select "Browse..." and choose your <strong>.CSV file</strong>.
        </li>
        <li>
            Select "Upload File".
        </li>
        <li>
            After five to ten seconds, a "Download File" link will appear at the
            bottom. Click this link to download your <strong>.STL file</strong>.
        </li>
        <li>
            You can then open this file in the 3D printing editing software
            of your choice. You will need to "fill down" the data on the
            z-axis so that it will 3D print properly. This is something that
            anyone managing the 3D printer at your school should be able to
            help you with.
        </li>
    </ol>

    <!-- File transform interface -->
    <h2>Transformation Form</h2>
    <div style="border-style: solid; width: 600px; padding: 10px;">
        <div id="upload_form">
            <p>Click here to upload a <strong>.CSV file</strong></p>
            <div>
                <input id="fileUpload" type="file" accept=".csv" />
                <button id="uploadButton" onclick="uploadFile()">Upload File</button>
            </div>
        </div>
        <div id="downloadMessage">After upload, transform will be available for download here</div>
    </div>

    <p>
        This website was created by a Senior at the University of Chicago
        Laboratory School. Matthew Bonges, a Physics Teacher at the University of
        Chicago Laboratory School provided guidance.
     </p>
    
    <p>
        If you have any comments or questions, please feel free to reach out to
        Matthew Bonges at mbonges@ucls.uchicago.edu.
    </p>

    <script>
    async function uploadFile() {
        const fileInput = document.getElementById('fileUpload');
        const file = fileInput.files[0];
        const downloadMessage = document.getElementById('downloadMessage');

        if (!file) {
            alert('No file selected.');
            return;
        }

        downloadMessage.innerHTML = "Transforming....";

        const reader = new FileReader();
        reader.onloadend = function() {
            // Get the file contents
            const arrayBuffer = reader.result;

            fetch('https://mvni37cg8e.execute-api.us-east-2.amazonaws.com/csv', {
                method: 'POST',
                headers: {
                    'Content-Type': file.type,
                },
                body: arrayBuffer,
            })
            .then(response => {
                // Ensure the request was successful
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json(); // Parse the JSON in the response
            })
            .then(data => {
                console.log('Success:', data);
                
                // Read the "location" field from the response
                const location = data.location;
                console.log('Location:', location);
                downloadMessage.innerHTML = `<a href="${location}">Download File</a>`;
            })
            .catch(error => {
                console.error('Error during fetch:', error);
                alert('Error uploading file.');
            });
        };

        reader.readAsArrayBuffer(file); // Read the file as a Data URL (base64)
    }

    </script>

</body>
</html>
